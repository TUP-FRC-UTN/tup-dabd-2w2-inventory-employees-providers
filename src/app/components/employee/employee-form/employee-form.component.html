<div class="card">
    <div class="card-body">
<div class="m-4">
    
  @if(!isEdit){
      <h2 class="mb-4">Registrar Empleado:</h2>
      } @else {
      <h2 class="mb-4">Modificar Empleado:</h2>
      }
      <form [formGroup]="employeeForm" (ngSubmit)="saveEmployee()" class="mt-3">
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="firstName" class="form-label"
              >Nombre<span class="text-danger">*</span></label
            >
            <div class="position-relative">
              <input
                type="text"
                formControlName="firstName"
                class="form-control"
                [ngClass]="{
                  'is-valid': employeeForm.get('firstName')?.valid,
                  'is-invalid':
                    employeeForm.get('firstName')?.invalid &&
                    employeeForm.get('firstName')?.touched
                }"
                id="firstName"
                placeholder="Ingrese el nombre"
              />
              <div
                *ngIf="employeeForm.get('firstName')?.valid"
                class="valid-feedback position-absolute top-10 end-0 mt-1 me-2"
              >
              </div>
              <div
                *ngIf="
                  employeeForm.get('firstName')?.invalid &&
                  employeeForm.get('firstName')?.touched
                "
              >
               Nombre es
                requerido
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <label for="lastName" class="form-label"
              >Apellido<span class="text-danger">*</span></label
            >
            <div class="position-relative">
              <input
                type="text"
                formControlName="lastName"
                class="form-control"
                [ngClass]="{
                  'is-valid': employeeForm.get('lastName')?.valid,
                  'is-invalid':
                    employeeForm.get('lastName')?.invalid &&
                    employeeForm.get('lastName')?.touched
                }"
                id="lastName"
                placeholder="Ingrese el apellido"
              />
              <div
                *ngIf="employeeForm.get('lastName')?.valid"
                class="valid-feedback position-absolute top-10 end-0 mt-1 me-2"
              >
              </div>
              <div
                *ngIf="
                  employeeForm.get('lastName')?.invalid &&
                  employeeForm.get('lastName')?.touched
                "
                class="invalid-feedback position-absolute top-10 end-0 mt-1 me-2"
              > Apellido es
                requerido
              </div>
            </div>
          </div>
        </div>
        <div class="row mb-3">
          <div class="col-md-6 mt-1">
            <label for="employeeType" class="form-label"
              >Tipo<span class="text-danger">*</span></label
            >
            <div class="position-relative">
              <select
                formControlName="employeeType"
                class="form-select"
                [ngClass]="{
                  'is-valid': employeeForm.get('employeeType')?.valid,
                  'is-invalid':
                    employeeForm.get('employeeType')?.invalid &&
                    employeeForm.get('employeeType')?.touched &&
                    employeeForm.get('employeeType')?.value !== 'ADMIN'
                }"
                id="employeeType"
              >
                <option value="" disabled>Seleccione tipo</option>
                <option *ngFor="let type of employeeTypes" [value]="type">
                  {{ type }}
                </option>
              </select>
              <div
                *ngIf="employeeForm.get('employeeType')?.valid"
                class="valid-feedback position-absolute top-10 end-0 mt-1 me-2"
              >
              </div>
              <div
                *ngIf="
                  employeeForm.get('employeeType')?.invalid &&
                  employeeForm.get('employeeType')?.touched
                "
                class="invalid-feedback position-absolute top-10 end-0 mt-1 me-2"
              >Tipo es
                requerido
              </div>
            </div>
          </div>
          <div class="col-md-6 mt-1">
            <label for="hiringDate" class="form-label"
              >Fecha de Contratación<span class="text-danger">*</span></label
            >
            <div class="position-relative">
              <input
                formControlName="hiringDate"
                type="date"
                class="form-control"
                [ngClass]="{
                  'is-valid': employeeForm.get('hiringDate')?.valid,
                  'is-invalid':
                    employeeForm.get('hiringDate')?.invalid &&
                    employeeForm.get('hiringDate')?.touched
                }"
                id="hiringDate"
              />
              <div
                *ngIf="employeeForm.get('hiringDate')?.valid"
                class="valid-feedback position-absolute top-10 end-0 mt-1 me-2"
              >
              </div>
              <div
                *ngIf="
                  employeeForm.get('hiringDate')?.invalid &&
                  employeeForm.get('hiringDate')?.touched
                "
                class="invalid-feedback position-absolute top-10 end-0 mt-1 me-2"
              > Fecha es
                requerida
              </div>
            </div>
          </div>
        </div>
        <div class="row mb-3 mt-1">
          <div class="col-md-6">
            <label for="documentType" class="form-label"
              >Tipo de Documento<span class="text-danger">*</span></label
            >
            <div class="position-relative">
              <select
                formControlName="documentType"
                class="form-select"
                [ngClass]="{
                  'is-valid': employeeForm.get('documentType')?.valid,
                  'is-invalid':
                    employeeForm.get('documentType')?.invalid &&
                    employeeForm.get('documentType')?.touched
                }"
                id="documentType"
              >
                <option value="" disabled>Seleccione tipo de documento</option>
                <option *ngFor="let type of documentTypes" [value]="type">
                  {{ type }}
                </option>
              </select>
              <div
                *ngIf="employeeForm.get('documentType')?.valid"
                class="valid-feedback position-absolute top-10 end-0 mt-1 me-2"
              >
              </div>
              <div
                *ngIf="
                  employeeForm.get('documentType')?.invalid &&
                  employeeForm.get('documentType')?.touched
                "
                class="invalid-feedback position-absolute top-10 end-0 mt-1 me-2"
              >
              Tipo de
                documento es requerido
              </div>
            </div>
          </div>
          <div class="col-md-6 mt-1">
            <label for="docNumber" class="form-label"
              >Documento<span class="text-danger">*</span></label
            >
            <div class="position-relative">
              <input
                type="text"
                formControlName="docNumber"
                class="form-control"
                [ngClass]="{
                  'is-valid': employeeForm.get('docNumber')?.valid,
                  'is-invalid':
                    employeeForm.get('docNumber')?.invalid &&
                    employeeForm.get('docNumber')?.touched
                }"
                id="docNumber"
                placeholder="Ingrese el número de documento"
              />
              <div
                *ngIf="employeeForm.get('docNumber')?.valid"
                class="valid-feedback position-absolute top-10 end-0 mt-1 me-2"
              >
              </div>
              <div
                *ngIf="
                  employeeForm.get('docNumber')?.invalid &&
                  employeeForm.get('docNumber')?.touched
                "
                class="invalid-feedback position-absolute top-10 end-0 mt-1 me-2"
              >Documento es
                requerido
              </div>
            </div>
          </div>
        </div>
        <div class="row mb-4">
          <div class="col-md-12 mt-1">
            <label for="salary" class="form-label"
              >Salario<span class="text-danger">*</span></label
            >
            <div class="input-group position-relative ms-2">
              <span class="input-group-text">$</span>
              <input
                type="number"
                formControlName="salary"
                class="form-control"
                [ngClass]="{
                  'is-valid': employeeForm.get('salary')?.valid,
                  'is-invalid':
                    employeeForm.get('salary')?.invalid &&
                    employeeForm.get('salary')?.touched
                }"
                id="salary"
                placeholder="Ingrese el salario"
              />
              <div
                *ngIf="employeeForm.get('salary')?.valid"
                class="valid-feedback position-absolute top-10 end-0 mt-1 me-2"
              >
              </div>
              <div
                *ngIf="
                  employeeForm.get('salary')?.invalid &&
                  employeeForm.get('salary')?.touched
                "
                class="invalid-feedback position-absolute top-10 end-0 mt-1 me-2"
              > Salario es
                requerido
              </div>
            </div>
        </div>
        <div class="card mb-4 mt-4">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="card-title mb-0">Contactos</h5>
              <button type="button" class="btn btn-primary btn-sm" (click)="addContact()">
                    <i class="bi bi-plus"></i> 
              </button>
            </div>
            <div class="card-body">
              <div formArrayName="contacts">
                <div *ngFor="let contact of contacts.controls; let i=index" [formGroupName]="i" class="row mb-2">
                  <div class="col-md-5">
                    <select formControlName="contact_type" class="form-select">
                      <option value="">Seleccione tipo</option>
                      <option *ngFor="let type of contactTypes" [value]="type">{{type}}</option>
                    </select>
                  </div>
                  <div class="col-md-5">
                    <input type="text" 
                           formControlName="contact_value" 
                           class="form-control" 
                           [placeholder]="contact.get('contact_type')?.value === 'EMAIL' ? 'Ingrese email' : 'Ingrese teléfono'">
                  </div>
                  <div class="col-md-2">
                    <button type="button" class="btn btn-danger btn-sm" (click)="removeContact(i)">
                        <i class="bi bi-x"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
    </div>
    <div class="d-flex justify-content-end gap-2">
        @if (!currentEmployeeId) {
            <button type="button" class="btn btn-secondary" (click)="onCancel()">Cancelar</button>
            <button type="submit" class="btn btn-primary" [disabled]="employeeForm.invalid">
              {{ !isEdit ? 'Registrar' : 'Modificar' }}
            </button>
          }
      </div>
</form>
</div>

    <ng-template #infoModal let-modal>
      <div class="modal-header fs-6 py-1">
        <h4 class="modal-title">Formulario de Empleados</h4>
        <button
          type="button"
          class="btn-close"
          aria-label="Close"
          (click)="modal.dismiss()"
        ></button>
      </div>
      <div class="modal-body fs-6 py-2">
        <div class="container-fluid">
          <!-- Introducción -->
          <div class="alert alert-info mb-2 py-2">
            <h5 class="alert-heading">¿Qué es esta pantalla?</h5>
            <p class="mb-0 small">
              Esta pantalla te permite registrar/actualizar un empleado.
            </p>
          </div>

          <!-- Campos Principales -->
          <div class="card mb-2">
            <div class="card-header py-1">
              <h5 class="mb-0">Datos de Empleados</h5>
            </div>
            <div class="card-body py-2">
              <ul class="list-group list-group-flush">
                <li class="list-group-item py-1">
                  <strong>Campos a ingresar:</strong> Se solicitarán: Nombre,
                  Apellido, Tipo, Documento, Tipo de Documento, Salario y Fecha
                  de Contratación.
                </li>
                <li class="list-group-item py-1">
                  <strong>ATENCIÓN:</strong> La opción de GUARDAR solo se
                  habilitará si todos los campos se encuentran correctamente
                  completados.
                </li>
              </ul>
            </div>
          </div>

          <!-- Acciones -->
          <div class="card mb-2">
            <div class="card-header py-1">
              <h5 class="mb-0">Acciones Disponibles</h5>
            </div>
            <div class="card-body py-2">
              <ul class="list-group list-group-flush">
                <li class="list-group-item py-1">
                  <strong>Guardar:</strong> En caso de que todos los campos se
                  encuentren correctamente completados se guardará el nuevo
                  empleado.
                </li>
                <li class="list-group-item py-1">
                  <strong>Cancelar:</strong> Se cancela el registro o la
                  actualización del empleado y nos devuelve al listado de
                  empleados.
                </li>
              </ul>
            </div>
          </div>

          <!-- Nota (OPCIONAL) -->
          <div class="alert alert-warning py-2 mb-0">
            <h5 class="alert-heading">Nota:</h5>
            <p class="mb-0 small">
              Asegúrate de verificar la información antes de modificar, ingresar
              o eliminar un empleado.
            </p>
          </div>
        </div>
      </div>
      <div class="modal-footer py-2">
        <button type="button" class="btn btn-primary" (click)="modal.close()">
          Entendido
        </button>
      </div>
    </ng-template>

  @if (currentEmployeeId) {
    <div class="mt-4">
      <app-employee-access 
        [employeeId]="currentEmployeeId"
        (schedulesSaved)="startNewEmployee()"
      ></app-employee-access>
    </div>
  }
